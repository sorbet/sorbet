<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Sorbet Language Server · Sorbet</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Sorbet implements the [Language Server Protocol], which allows using Sorbet within virtually any text editor."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Sorbet Language Server · Sorbet"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sorbet.org/"/><meta property="og:description" content="Sorbet implements the [Language Server Protocol], which allows using Sorbet within virtually any text editor."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://sorbet.org/blog/atom.xml" title="Sorbet Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://sorbet.org/blog/feed.xml" title="Sorbet Blog RSS Feed"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5H7PQ9Z8KF"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'G-5H7PQ9Z8KF');
            </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/sorbet-logo-white-sparkles.svg" alt="Sorbet"/><h2 class="headerTitleWithLogo">Sorbet</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/adopting" target="_self">Get started</a></li><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Docs</a></li><li class=""><a href="https://sorbet.run" target="_self">Try</a></li><li class=""><a href="/en/community" target="_self">Community</a></li><li class=""><a href="https://github.com/sorbet/sorbet" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Editor Features</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/adopting">Adopting Sorbet</a></li><li class="navListItem"><a class="navItem" href="/docs/metrics">Tracking Adoption</a></li><li class="navListItem"><a class="navItem" href="/docs/quickref">Quick Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/vscode">Visual Studio Code</a></li><li class="navListItem"><a class="navItem" href="/docs/from-typescript">TypeScript ↔ Sorbet</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Static &amp; Runtime</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/gradual">Gradual Type Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/static">Enabling Static Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/runtime">Enabling Runtime Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/rbi">RBI Files</a></li><li class="navListItem"><a class="navItem" href="/docs/cli">CLI Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/cli-ref">CLI Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/tconfiguration">Runtime Configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/troubleshooting">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/docs/why-type-annotations">Why type annotations?</a></li><li class="navListItem"><a class="navItem" href="/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/error-reference">Error Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/unsupported">Unsupported Ruby Features</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Type System</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/sigs">sig</a></li><li class="navListItem"><a class="navItem" href="/docs/type-annotations">Type Annotations (non-sig)</a></li><li class="navListItem"><a class="navItem" href="/docs/type-assertions">T.let, T.cast, T.must, T.bind</a></li><li class="navListItem"><a class="navItem" href="/docs/class-types">Class Types (Integer, String)</a></li><li class="navListItem"><a class="navItem" href="/docs/stdlib-generics">Arrays &amp; Hashes</a></li><li class="navListItem"><a class="navItem" href="/docs/nilable-types">Nilable Types (T.nilable)</a></li><li class="navListItem"><a class="navItem" href="/docs/union-types">Union Types (T.any)</a></li><li class="navListItem"><a class="navItem" href="/docs/flow-sensitive">Flow-Sensitivity (is_a?, nil?)</a></li><li class="navListItem"><a class="navItem" href="/docs/type-aliases">T.type_alias</a></li><li class="navListItem"><a class="navItem" href="/docs/exhaustiveness">Exhaustiveness (T.absurd)</a></li><li class="navListItem"><a class="navItem" href="/docs/tstruct">T::Struct</a></li><li class="navListItem"><a class="navItem" href="/docs/tenum">T::Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/untyped">T.untyped</a></li><li class="navListItem"><a class="navItem" href="/docs/procs">Blocks, Procs, &amp; Lambdas</a></li><li class="navListItem"><a class="navItem" href="/docs/abstract">Abstract Classes &amp; Interfaces</a></li><li class="navListItem"><a class="navItem" href="/docs/final">Final Methods &amp; Classes</a></li><li class="navListItem"><a class="navItem" href="/docs/override-checking">Override Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/sealed">Sealed Classes</a></li><li class="navListItem"><a class="navItem" href="/docs/class-of">T.class_of</a></li><li class="navListItem"><a class="navItem" href="/docs/self-type">T.self_type</a></li><li class="navListItem"><a class="navItem" href="/docs/noreturn">T.noreturn</a></li><li class="navListItem"><a class="navItem" href="/docs/anything">T.anything</a></li><li class="navListItem"><a class="navItem" href="/docs/attached-class">T.attached_class</a></li><li class="navListItem"><a class="navItem" href="/docs/intersection-types">Intersection Types (T.all)</a></li><li class="navListItem"><a class="navItem" href="/docs/generics">Generics</a></li><li class="navListItem"><a class="navItem" href="/docs/strong">Banning untyped</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Ruby &amp; DSL Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/attr_reader">attr_reader</a></li><li class="navListItem"><a class="navItem" href="/docs/minitest">minitest</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Editor Features</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/lsp">Language Server (LSP)</a></li><li class="navListItem"><a class="navItem" href="/docs/server-status">Server Status</a></li><li class="navListItem"><a class="navItem" href="/docs/lsp-typed-level">LSP &amp; Typed Level</a></li><li class="navListItem"><a class="navItem" href="/docs/go-to-def">Go to Definition</a></li><li class="navListItem"><a class="navItem" href="/docs/hover">Hover</a></li><li class="navListItem"><a class="navItem" href="/docs/autocompletion">Autocompletion</a></li><li class="navListItem"><a class="navItem" href="/docs/references">Find All References</a></li><li class="navListItem"><a class="navItem" href="/docs/code-actions">Code Actions</a></li><li class="navListItem"><a class="navItem" href="/docs/outline">Outline &amp; Document Symbols</a></li><li class="navListItem"><a class="navItem" href="/docs/doc-comments">Documentation Comments</a></li><li class="navListItem"><a class="navItem" href="/docs/sig-suggestion">Suggesting sigs</a></li><li class="navListItem"><a class="navItem" href="/docs/highlight-untyped">Highlighting untyped</a></li><li class="navListItem"><a class="navItem" href="/docs/sorbet-uris">sorbet: URIs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Experimental Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/tuples">Tuples</a></li><li class="navListItem"><a class="navItem" href="/docs/shapes">Shapes</a></li><li class="navListItem"><a class="navItem" href="/docs/overloads">Overloads</a></li><li class="navListItem"><a class="navItem" href="/docs/requires-ancestor">Requiring Ancestors</a></li><li class="navListItem"><a class="navItem" href="/docs/rbs-support">RBS Comments</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/sorbet/sorbet/edit/master/website/docs/lsp.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Sorbet Language Server</h1></header><article><div><span><p>Sorbet implements the <a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a>, which allows using Sorbet within virtually any text editor.</p>
<p>The recommended way to interface with Sorbet’s language server is via the <a href="/docs/vscode">Sorbet VS Code extension</a>, but it’s possible to use Sorbet with other language clients.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<h3><a class="anchor" aria-hidden="true" id="watchman"></a><a href="#watchman" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Watchman</h3>
<p>For the best experience, Sorbet requires <a href="https://facebook.github.io/watchman/">Watchman</a>, which listens for changes to the files on disk in addition to edits that happen to files open in the editor. For example, without Watchman installed, Sorbet will not detect when files have changed on disk due to things like changing the currently checked out branch.</p>
<p>There are installation instructions for installing watchman on various platforms in the <a href="https://facebook.github.io/watchman/docs/install.html">Watchman docs</a>.</p>
<p>To get Sorbet working with watchman, there are three options:</p>
<ol>
<li><p>Simply install the <code>watchman</code> binary somewhere visible via the <code>PATH</code> environment variable. Sorbet will automatically discover it.</p></li>
<li><p>Install the <code>watchman</code> binary anywhere, and specify the path to it using the <code>--watchman-path</code> command line flag to Sorbet (pass it whenever you pass the <code>--lsp</code> flag according to the next section).</p></li>
<li><p>Opt out of using watchman, with the <code>--disable-watchman</code> flag. Sorbet will only read files from disk at startup, and afterwards will only see contents of files that have been opened or changed in the editor.</p></li>
</ol>
<p>Note that watchman requires a project to be version controlled (e.g. have a <code>.git</code> folder in the project root) or have a <code>.watchmanconfig</code> file at the root of the project. Without one of these, watchman will not start successfully.</p>
<p>“Why watchman?” See <a href="#a-note-on-watchman">A note on watchman</a> below.</p>
<h3><a class="anchor" aria-hidden="true" id="a-single-input-directory"></a><a href="#a-single-input-directory" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A single input directory</h3>
<p>While the <code>srb tc</code> command accepts any number of files and folders (and will type check all provided files), Sorbet in LSP mode requires a single input directory.</p>
<p>This is an artificial limitation that we hope to lift in the future.</p>
<p>The best way to workaround this is to use one or more <code>--ignore</code> flags to ignore folders that should be excluded. For example, given a project like this, where you only want to typecheck <code>lib/</code> and <code>test/</code> but not <code>bin/</code>:</p>
<pre><code class="hljs css language-plaintext">.
├── bin/
├── lib/
└── test/
</code></pre>
<p>Use this in your <code>sorbet/config</code> file:</p>
<pre><code class="hljs css language-bash">--dir=.
--ignore=/bin
</code></pre>
<p>instead of this, which will <strong>not</strong> work in LSP mode:</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># ❌ will not work ❌</span>
--dir=lib
--dir=<span class="hljs-built_in">test</span>
</code></pre>
<p>Using <code>--ignore</code> flags like this is imperfect and will not always work, but it’s the best current workaround. For more, see <a href="/docs/cli#including-and-excluding-files">Including and excluding files</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="using-sorbet-as-a-language-server"></a><a href="#using-sorbet-as-a-language-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Sorbet as a language server</h2>
<p>With the <a href="#prerequisites">Prerequisites</a> out of the way, simply add the <code>--lsp</code> flag to however you invoke Sorbet right now. Some examples:</p>
<pre><code class="hljs css language-bash">srb tc --lsp

<span class="hljs-comment"># ... if you use Sorbet via bundler:</span>
bundle <span class="hljs-built_in">exec</span> srb tc --lsp

<span class="hljs-comment"># ... if you've built Sorbet from source:</span>
bazel-bin/main/sorbet --lsp

<span class="hljs-comment"># ... if you need to pass other LSP-related flags:</span>
srb tc --lsp --watchman-path=/path/to/watchman
</code></pre>
<p>The final step is to teach your language client to run this command whenever inside a Sorbet project. Check to see if <a href="#instructions-for-specific-language-clients">instructions for your language client</a> are below, or consider contributing!</p>
<h2><a class="anchor" aria-hidden="true" id="other-useful-lsp-related-flags"></a><a href="#other-useful-lsp-related-flags" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other useful LSP-related flags</h2>
<p>A short list of useful LSP-related command line flags:</p>
<ul>
<li><p><code>--dir=...</code></p>
<p>Sorbet in LSP mode requires a single input directory. The language server protocol has support for multiple workspace root directories (<code>workspaceFolders</code>) but Sorbet does not support this yet.</p></li>
<li><p><code>--ignore=...</code></p>
<p>Ignores certain paths. The <code>...</code> is a file pattern in a Sorbet-specific format. See <a href="/docs/cli#including-and-excluding-files">Including and excluding files</a> or <code>srb tc --help</code> for more information.</p></li>
<li><p><code>--cache-dir=...</code></p>
<p>When an edit causes Sorbet to <a href="server-status#why-do-some-of-my-edits-make-sorbet-go-back-to-typechecking">retypecheck the whole workspace</a>, supplying a cache directory with the <a href="cli#--cache-dir-caching-parse-results"><code>--cache-dir</code></a> flag allows it to avoid reindexing files that haven’t changed. This improves performance, shortening the duration of that slow path operation.</p></li>
<li><p><code>--disable-watchman</code> / <code>--watchman-path=...</code></p>
<p>Configure whether or how the <code>watchman</code> binary is invoked.</p></li>
<li><p><code>--enable-all-beta-lsp-features</code></p>
<p>Enable all language server features the Sorbet team considers ready for open beta. The set of features changes over time. Please give your feedback!</p></li>
<li><p><code>--enable-all-experimental-lsp-features</code></p>
<p>Enable all language server features, even those that might be unreliable or cause Sorbet to crash frequently. Please give us your feedback!</p></li>
<li><p><em>assorted <code>--enable-experimental-lsp-*</code> flags</em>, (see <code>srb tc --help</code>)</p>
<p>In addition to enabling all beta or all experimental LSP features, most work-in-progress LSP features have their own command line flag to enable that feature and no others.</p>
<p>Note that these flags are removed when the feature is finalized, which can cause Sorbet to fail to start (unrecognized command line flag).</p></li>
<li><p><code>--lsp-error-cap</code></p>
<p>Certain language clients deal poorly with large quantities of diagnostics (errors, warnings, information hints, etc.). Sorbet caps the number of diagnostics it sends to clients at 1,000 diagnostics, but this can be changed (set it to <code>0</code> to remove the cap).</p></li>
</ul>
<p>For all Sorbet flags, be sure to check <code>srb tc --help</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="instructions-for-specific-language-clients"></a><a href="#instructions-for-specific-language-clients" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Instructions for specific language clients</h2>
<p>Each language client will have its own mechanism for starting the language server.</p>
<h3><a class="anchor" aria-hidden="true" id="neovim"></a><a href="#neovim" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Neovim</h3>
<p>The <a href="https://github.com/neovim/nvim-lspconfig">nvim-lspconfig</a> project includes support for Sorbet. Add this to your <code>init.lua</code> file:</p>
<pre><code class="hljs css language-lua"><span class="hljs-keyword">local</span> lspconfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lspconfig'</span>)
lspconfig.sorbet.setup {}
</code></pre>
<p>The default command is <code>srb tc --lsp</code>. To tweak the command used to start the server, set the <code>cmd</code> property:</p>
<pre><code class="hljs css language-lua"><span class="hljs-keyword">local</span> lspconfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lspconfig'</span>)
lspconfig.sorbet.setup {
  cmd = { <span class="hljs-string">"bundle"</span>, <span class="hljs-string">"exec"</span>, <span class="hljs-string">"srb"</span>, <span class="hljs-string">"tc"</span>, <span class="hljs-string">"--lsp"</span> },
}
</code></pre>
<p>To specify custom <a href="#initialize-request"><code>initializationOptions</code></a>, set the <code>init_options</code> property:</p>
<pre><code class="hljs css language-lua"><span class="hljs-keyword">local</span> lspconfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lspconfig'</span>)
lspconfig.sorbet.setup {
  cmd = { <span class="hljs-string">"bundle"</span>, <span class="hljs-string">"exec"</span>, <span class="hljs-string">"srb"</span>, <span class="hljs-string">"tc"</span>, <span class="hljs-string">"--lsp"</span> },
  init_options = {
    highlightUntyped = <span class="hljs-literal">true</span>,
  },
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="other-clients"></a><a href="#other-clients" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other clients</h3>
<p>If you use Sorbet with a particular language client and want to help out, please edit this page to add instructions!</p>
<h2><a class="anchor" aria-hidden="true" id="sorbet-specific-lsp-extensions"></a><a href="#sorbet-specific-lsp-extensions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sorbet-specific LSP extensions</h2>
<p>Sorbet includes a handful of custom extensions to the language server protocol.</p>
<p>The reason we recommend the <a href="/docs/vscode">Sorbet VS Code extension</a> is that these custom extensions are supported out-of-the-box when using that client.</p>
<p>Taking advantage of Sorbet’s custom extensions in other clients is possible, but requires some manual configuration work.</p>
<h3><a class="anchor" aria-hidden="true" id="initialize-request"></a><a href="#initialize-request" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>initialize</code> request</h3>
<p>Sorbet recognizes the following options in the <code>initializationOptions</code> of the <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#initialize"><code>initialize</code></a> LSP request:</p>
<pre><code class="hljs css language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> SorbetInitializationOptions {
  highlightUntyped?: <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">string</span>;
  enableTypedFalseCompletionNudges?: <span class="hljs-built_in">boolean</span>;
  supportsOperationNotifications?: <span class="hljs-built_in">boolean</span>;
  supportsSorbetURIs?: <span class="hljs-built_in">boolean</span>;
  supportsSorbetURIs?: <span class="hljs-built_in">boolean</span>;
  highlightUntypedDiagnosticSeverity?: DiagnosticSeverity;
}
</code></pre>
<ul>
<li><p><code>highlightUntyped</code></p>
<p>Whether to <a href="/docs/highlight-untyped">highlight usages of untyped</a> even outside of <code># typed: strong</code> files. Default: <code>&quot;everywhere&quot;</code></p></li>
<li><p><code>enableTypedFalseCompletionNudges</code></p>
<p>Whether to show a notice explaining when Sorbet refuses to provide completion results because a file is <code># typed: false</code>. Default: <code>true</code></p>
<p>See <a href="/docs/lsp-typed-level#-typed-false-nudges"><code># typed: false</code> nudges</a></p></li>
<li><p><code>supportsOperationNotifications</code></p>
<p>See <a href="/docs/server-status#api">Showing the Language Server Status</a></p></li>
<li><p><code>supportsSorbetURIs</code></p>
<p>See <a href="/docs/sorbet-uris">Working with Synthetic or Missing Files</a></p></li>
<li><p><code>highlightUntypedDiagnosticSeverity</code></p>
<p>What “severity” to report usages of untyped in the client. This is to workaround limitations in the LSP specification and VS Code. See <a href="/docs/highlight-untyped#customizing-the-presentation-of-untyped-highlights">the relevant section</a> for more information.</p>
<p><strong>Note</strong> that <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#diagnosticSeverity"><code>DiagnosticSeverity</code></a> is an <code>integer</code>-valued enum, as per the LSP specification.</p></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="workspacedidchangeconfiguration-notification"></a><a href="#workspacedidchangeconfiguration-notification" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>workspace/didChangeConfiguration</code> notification</h3>
<p>Sorbet recognizes the same options in the <code>settings</code> field of the <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#didChangeConfigurationParams"><code>DidChangeConfigurationParams</code></a> as it recognizes in the <code>initializationOptions</code> of the <a href="#initialize-request"><code>initialize</code> request</a> above.</p>
<p>See the definition of <a href="#initialize-request"><code>SorbetInitializationOptions</code></a> above.</p>
<h3><a class="anchor" aria-hidden="true" id="sorbetshowoperation-notification"></a><a href="#sorbetshowoperation-notification" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>sorbet/showOperation</code> notification</h3>
<p>The Sorbet VS Code extension gives an indication of whether Sorbet is currently “Idle,” meaning it has finished all requested work and is waiting, or whether there is a current long-running operation which may affect things like whether all the errors have been reported and whether Sorbet is able to respond to certain editor commands.</p>
<p>This feature is powered by the custom <code>sorbet/showOperation</code> LSP server-to-client notification:</p>
<p><em>Notification</em>:</p>
<ul>
<li>method: <code>sorbet/showOperation</code></li>
<li>params: <code>SorbetShowOperationParams</code> defined as follows</li>
</ul>
<pre><code class="hljs css language-typescript"><span class="hljs-keyword">interface</span> SorbetShowOperationParams {
  <span class="hljs-comment">/**
   * A stable identifier for this operation. At time of writing, this includes:
   *
   * - "Indexing"
   * - "SlowPathBlocking"
   * - "SlowPathNonBlocking"
   * - "FastPath"
   * - "References"
   * - "SymbolSearch"
   * - "Rename"
   * - "MoveMethod"
   *
   * Use this field if it's important to programmatically detect a certain state
   * in the language client, as these identifiers are stable and unlikely to change.
   */</span>
  operationName: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">/**
   * An unstable, human-readable description of a given operation. We reserve
   * the right to change these descriptions in future versions of Sorbet, so to
   * programmatically detect them, use `operationName`.
   *
   * Use these descriptions to show the user what operation is currently ongoing.
   * This field contains the operation descriptions documented above, like
   * "Typechecking..." instead of the technical "SlowPathBlocking" identifier.
   */</span>
  description: <span class="hljs-built_in">string</span>;

  <span class="hljs-comment">/**
   * Operations can overlap. For example, a "References" operation can overlap
   * with a "SlowPathNonBlocking" operation. This field indicates whether an
   * operation is starting or ending, so the language client can track
   * overlapping operations.
   *
   * Typically language clients will display only the most recently received
   * operation notification as the current active operation. For example, if a
   * SlowPathNonBlocking operation is ongoing and a new References operation
   * begins, the client will show "Finding all references..." until that
   * operation ends, at which point the client will once again display
   * "Typechecking in background..." (until the SlowPathNonBlocking operation
   * also ends).
   *
   * When there is no active operation, language clients typically display
   * something indicating that the process is idle, like "Idle" or ✅ or
   * something else.
   *
   * There will only be one active operation for a given `operationName` at any
   * given time.
   */</span>
  status: SorbetOperationStatus;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> SorbetOperationStatus = <span class="hljs-string">'start'</span> | <span class="hljs-string">'end'</span>;
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="sorbetshowsymbol-request"></a><a href="#sorbetshowsymbol-request" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>sorbet/showSymbol</code> request</h3>
<p>The Sorbet VS Code extension has a context menu item called “Copy Symbol to Clipboard,” which copies the fully-qualified name of the thing currently under the cursor. For example:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>
      <span class="hljs-comment">#   ^ Copy Symbol to Clipboard</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Given this snippet, VS Code puts <code>A::B::C</code> on the system clipboard.</p>
<p>This feature is powered by the custom <code>sorbet/showSymbol</code> LSP request:</p>
<p><em>Request</em>:</p>
<ul>
<li>method: <code>sorbet/showSymbol</code></li>
<li>params: <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocumentPositionParams"><code>TextDocumentPositionParams</code></a></li>
</ul>
<p><em>Response</em>:</p>
<ul>
<li>result: <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#symbolInformation"><code>SymbolInformation</code></a> | <code>null</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="sorbetreadfile-request"></a><a href="#sorbetreadfile-request" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>sorbet/readFile</code> request</h3>
<p>See <a href="/docs/sorbet-uris">Working with Synthetic or Missing Files</a> for more information.</p>
<p><em>Request</em>:</p>
<ul>
<li>method: <code>sorbet/readFile</code></li>
<li>params: <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocumentIdentifier"><code>TextDocumentIdentifier</code></a></li>
</ul>
<p><em>Response</em>:</p>
<ul>
<li>result: <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocumentItem"><code>TextDocumentItem</code></a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="sorbethierarchyreferences-request"></a><a href="#sorbethierarchyreferences-request" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>sorbet/hierarchyReferences</code> request</h3>
<!-- TODO(jez) Document this -->
<!-- TODO(jez) Advertise how to use this in VS Code from the references.md doc -->
<p>Finds all references to the symbol under the cursor, plus references to any others that it overrides or is overridden by. That is, it finds references to a given symbol throughout the entire inheritance hierarchy. If the thing at the cursor is a call to a method <code>Child#foo</code> that overrides an abstract <code>Parent#foo</code> method from a super class and is further overridden by a <code>GrandChild#foo</code> method in a subclass, Sorbet finds references to all three of these symbols throughout the workspace.</p>
<p><em>Request</em>:</p>
<ul>
<li>method: <code>sorbet/hierarchyReferences</code></li>
<li>params: <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#referenceParams"><code>ReferenceParams</code></a></li>
</ul>
<p><em>Response</em>:</p>
<ul>
<li>result: <code><a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#location">Location</a>[] | null </code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="sorbetsavepackagefiles-command"></a><a href="#sorbetsavepackagefiles-command" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>sorbet.savePackageFiles</code> command</h3>
<p>The Sorbet language server will sometimes request that the <code>sorbet.savePackageFiles</code> command is run. This command is meant to be implemented by language clients.</p>
<p>Each language client has a way to register commands that are not part of the core language server protocol. For example, in Neovim, a command is registered like this:</p>
<pre><code class="hljs css language-lua">vim.lsp.commands[<span class="hljs-string">'sorbet.savePackageFiles'</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(command)</span></span>
  <span class="hljs-comment">-- ...</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Sorbet includes this <code>sorbet.savePackageFiles</code> command in the <code>command</code> field of certain <code>CodeAction</code> responses, and the Sorbet VS Code extension includes <a href="https://github.com/sorbet/sorbet/blob/546293d16abbb6ea41704c147544569c7508a572/vscode_extension/src/commands/savePackageFiles.ts#L11">an implementation</a>. The idea is that certain code actions make edits in files that the user did not open on their own, and so by not saving the edits from Sorbet’s code, they don’t realize that they need to switch over to those files and save them for the code action’s edits to have been reflected on disk.</p>
<p>See <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#codeAction">CodeAction</a> and <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#command">Command</a> in the LSP specification.</p>
<h2><a class="anchor" aria-hidden="true" id="appendix"></a><a href="#appendix" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Appendix</h2>
<h3><a class="anchor" aria-hidden="true" id="a-note-on-watchman"></a><a href="#a-note-on-watchman" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A note on watchman</h3>
<p>Recall that file watching is important in the first place because certain file edits may come from files on disk changing despite not being open in the client itself (for example, doing a <code>git pull</code>, or editing files with some script).</p>
<p>The language server protocol includes support for client-side file watching as of <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#version_3_17_0">version 3.17</a>. Sorbet does not use this functionality, but might in the future. Instead, Sorbet does file watching with watchman.</p>
<p>Sorbet’s language <em>server</em> is designed so that it can be run on a separate host from where the language <em>client</em> runs. For example, the language client (VS Code) can be running on a laptop, while the server process can be started via an SSH connection to a remote host, communicating back and forth to the laptop via the SSH connection’s stdin/stdout pipe:</p>
<pre><code class="hljs css language-bash">ssh some.remote.host -- <span class="hljs-string">'cd project; bundle exec srb tc --lsp'</span>
</code></pre>
<p>In setups like these, certain files in the codebase may not actually exist according to the client. For example, certain generated files may only be generated on the remote host, not the laptop. The language client would not notice changes to these generated files, but a watchman binary running on the same remote host as the Sorbet language server would.</p>
<p>Sorbet may add support for LSP-powered file watching in the future (to make Sorbet easier to use when not using Sorbet over SSH like this). But as specified, the current protocol is not powerful enough to completely replace Sorbet’s need for watchman.</p>
<p>Also, watchman uses an algorithm to find the “project path” when setting up file watches. This algorithm is <a href="https://facebook.github.io/watchman/docs/cmd/watch-project#whats-a-project-path">described here</a> in detail, but basically reduces to “there must be either a <code>.git</code>, <code>.hg</code>, <code>.svn</code>, or <code>.watchmanconfig</code> file in the watched folder or some parent folder.” This list of project indicators is not configurable by Sorbet–it can only be configured globally for an entire machine. See <a href="https://facebook.github.io/watchman/docs/config#root_files"><code>root_files</code></a> and <a href="https://facebook.github.io/watchman/docs/config#resolution--scoping">Resolution / Scoping</a> for more.</p>
<p>Thus, to use Sorbet with watchman in a project that does not use Git, create an empty <code>.watchmanconfig</code> file in the root of the project.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/minitest"><span class="arrow-prev">← </span><span>minitest</span></a><a class="docs-next button" href="/docs/server-status"><span>Server Status</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a><ul class="toc-headings"><li><a href="#watchman">Watchman</a></li><li><a href="#a-single-input-directory">A single input directory</a></li></ul></li><li><a href="#using-sorbet-as-a-language-server">Using Sorbet as a language server</a></li><li><a href="#other-useful-lsp-related-flags">Other useful LSP-related flags</a></li><li><a href="#instructions-for-specific-language-clients">Instructions for specific language clients</a><ul class="toc-headings"><li><a href="#neovim">Neovim</a></li><li><a href="#other-clients">Other clients</a></li></ul></li><li><a href="#sorbet-specific-lsp-extensions">Sorbet-specific LSP extensions</a><ul class="toc-headings"><li><a href="#initialize-request"><code>initialize</code> request</a></li><li><a href="#workspacedidchangeconfiguration-notification"><code>workspace/didChangeConfiguration</code> notification</a></li><li><a href="#sorbetshowoperation-notification"><code>sorbet/showOperation</code> notification</a></li><li><a href="#sorbetshowsymbol-request"><code>sorbet/showSymbol</code> request</a></li><li><a href="#sorbetreadfile-request"><code>sorbet/readFile</code> request</a></li><li><a href="#sorbethierarchyreferences-request"><code>sorbet/hierarchyReferences</code> request</a></li><li><a href="#sorbetsavepackagefiles-command"><code>sorbet.savePackageFiles</code> command</a></li></ul></li><li><a href="#appendix">Appendix</a><ul class="toc-headings"><li><a href="#a-note-on-watchman">A note on watchman</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><div class="wrapper"><p class="footer"><svg width="99" height="28" viewBox="0 0 99 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.98432 20H6.27432C8.44932 20 9.81432 18.905 9.81432 17.03C9.81432 15.665 9.00432 14.72 7.78932 14.39C8.61432 14.105 9.45432 13.415 9.45432 12.035C9.45432 10.235 8.23932 9.23 5.95932 9.23H1.98432V20ZM3.37932 13.85V10.445H5.83932C7.27932 10.445 8.07432 11 8.07432 12.155C8.07432 13.295 7.27932 13.85 5.83932 13.85H3.37932ZM3.37932 15.08H6.21432C7.65432 15.08 8.43432 15.83 8.43432 16.925C8.43432 18.035 7.65432 18.785 6.21432 18.785H3.37932V15.08ZM18.0294 12.155H16.6794V16.88C16.6794 18.185 15.6894 18.92 14.7144 18.92C13.5594 18.92 13.0794 18.17 13.0794 17.06V12.155H11.7294V17.345C11.7294 19.01 12.6744 20.165 14.3544 20.165C15.4644 20.165 16.2294 19.58 16.6794 18.92V20H18.0294V12.155ZM20.5112 10.79H21.9812V9.23H20.5112V10.79ZM21.9212 12.155H20.5712V20H21.9212V12.155ZM25.8247 9.23H24.4747V20H25.8247V9.23ZM28.5882 18.125C28.5882 19.625 29.3532 20.075 30.6882 20.075C31.1382 20.075 31.5282 20.03 31.8732 19.955V18.8C31.5582 18.875 31.3332 18.89 31.0182 18.89C30.3282 18.89 29.9232 18.74 29.9232 17.915V13.31H31.7082V12.155H29.9232V9.86H28.5882V12.155H27.3732V13.31H28.5882V18.125ZM41.0199 20.165C43.1949 20.165 44.4399 18.305 44.4399 16.085C44.4399 13.85 43.1949 12.005 41.0199 12.005C39.9249 12.005 39.0549 12.53 38.5899 13.295V9.23H37.2399V20H38.5899V18.86C39.0549 19.64 39.9249 20.165 41.0199 20.165ZM38.5599 15.815C38.5599 13.985 39.6699 13.19 40.7799 13.19C42.2499 13.19 43.0749 14.39 43.0749 16.085C43.0749 17.765 42.2499 18.98 40.7799 18.98C39.6699 18.98 38.5599 18.17 38.5599 16.37V15.815ZM49.1804 20.855L52.5554 12.155H51.1454L48.9704 18.155L46.7654 12.155H45.3404L48.2504 19.715L47.8754 20.645C47.5604 21.425 47.2454 21.635 46.6604 21.635C46.4354 21.635 46.2704 21.62 46.0154 21.56V22.73C46.2554 22.775 46.4204 22.79 46.7504 22.79C48.1154 22.79 48.7304 22.04 49.1804 20.855Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M98.7993 15.7838C98.7993 12.8786 97.3871 10.5862 94.688 10.5862C91.9774 10.5862 90.3374 12.8786 90.3374 15.7611C90.3374 19.177 92.2735 20.9019 95.0524 20.9019C96.4077 20.9019 97.4327 20.5955 98.2071 20.1643V17.8946C97.4327 18.2804 96.5443 18.5188 95.4168 18.5188C94.3121 18.5188 93.3327 18.1329 93.2074 16.7938H98.7766C98.7766 16.6463 98.7993 16.0561 98.7993 15.7838ZM93.1732 14.7057C93.1732 13.4233 93.9591 12.8899 94.6766 12.8899C95.3713 12.8899 96.1116 13.4233 96.1116 14.7057H93.1732Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M85.9413 10.5862C84.8251 10.5862 84.1076 11.1082 83.709 11.4714L83.561 10.7678H81.0554V24.0001L83.9026 23.3986L83.914 20.187C84.324 20.482 84.9276 20.9019 85.9299 20.9019C87.9685 20.9019 89.8249 19.2678 89.8249 15.6703C89.8135 12.3792 87.9343 10.5862 85.9413 10.5862ZM85.2579 18.4053C84.586 18.4053 84.1874 18.167 83.914 17.8719L83.9026 13.6616C84.1988 13.3325 84.6088 13.1055 85.2579 13.1055C86.2943 13.1055 87.0118 14.2631 87.0118 15.7497C87.0118 17.2704 86.3057 18.4053 85.2579 18.4053Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M77.1377 9.91656L79.9963 9.30374V7L77.1377 7.60147V9.91656Z" fill="white"></path><path d="M79.9963 10.7791H77.1377V20.709H79.9963V10.7791Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M74.074 11.6187L73.8918 10.7789H71.4318V20.7088H74.279V13.9792C74.9509 13.1054 76.0898 13.2642 76.4429 13.3891V10.7789C76.0784 10.6427 74.7459 10.3931 74.074 11.6187Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M68.3796 8.31641L65.6007 8.90653L65.5894 17.9966C65.5894 19.6762 66.8535 20.9132 68.5391 20.9132C69.473 20.9132 70.1563 20.743 70.5321 20.5387V18.235C70.1677 18.3825 68.3682 18.9045 68.3682 17.225V13.1962H70.5321V10.779H68.3682L68.3796 8.31641Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M60.6807 13.6616C60.6807 13.219 61.0452 13.0488 61.6488 13.0488C62.5143 13.0488 63.6076 13.3098 64.4732 13.7751V11.1082C63.5279 10.7337 62.594 10.5862 61.6488 10.5862C59.3368 10.5862 57.7993 11.7891 57.7993 13.7978C57.7993 16.93 62.1271 16.4306 62.1271 17.7811C62.1271 18.3031 61.6715 18.4734 61.0338 18.4734C60.0885 18.4734 58.8813 18.0875 57.9246 17.5655V20.2664C58.9838 20.7204 60.0543 20.9133 61.0338 20.9133C63.4026 20.9133 65.0313 19.7444 65.0313 17.713C65.0199 14.3312 60.6807 14.9326 60.6807 13.6616Z" fill="white"></path></svg><a href="/docs/adopting">Get started</a> · <a href="/docs/overview">Docs</a> · <a href="https://sorbet.run">Try</a> · <a href="/en/community">Community</a> · <a href="/blog">Blog</a> · <a href="https://twitter.com/sorbet_ruby">Twitter</a></p></div><div id="csat-extension-config" data-notify="#sorbet-team"></div></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                appId: 'ZYWC6Z01G8',
                apiKey: 'b05a65e9f8d9f50dc4ec3241db8836c4',
                indexName: 'stripe_sorbet',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>