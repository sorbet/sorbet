<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Arrays, Hashes, and Generics in the Standard Library · Sorbet</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The Sorbet syntax for type annotations representing arrays, hash maps, and other containers defined in the Ruby standard library looks different from other [class types](/docs/class-types) despite the fact that Ruby uses classes to represent these values, too. Here&#x27;s the syntax Sorbet uses:"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Arrays, Hashes, and Generics in the Standard Library · Sorbet"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sorbet.org/"/><meta property="og:description" content="The Sorbet syntax for type annotations representing arrays, hash maps, and other containers defined in the Ruby standard library looks different from other [class types](/docs/class-types) despite the fact that Ruby uses classes to represent these values, too. Here&#x27;s the syntax Sorbet uses:"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://sorbet.org/blog/atom.xml" title="Sorbet Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://sorbet.org/blog/feed.xml" title="Sorbet Blog RSS Feed"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5H7PQ9Z8KF"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'G-5H7PQ9Z8KF');
            </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/sorbet-logo-white-sparkles.svg" alt="Sorbet"/><h2 class="headerTitleWithLogo">Sorbet</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/adopting" target="_self">Get started</a></li><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Docs</a></li><li class=""><a href="https://sorbet.run" target="_self">Try</a></li><li class=""><a href="/en/community" target="_self">Community</a></li><li class=""><a href="https://github.com/sorbet/sorbet" target="_self">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Type System</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/adopting">Adopting Sorbet</a></li><li class="navListItem"><a class="navItem" href="/docs/metrics">Tracking Adoption</a></li><li class="navListItem"><a class="navItem" href="/docs/quickref">Quick Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/vscode">Visual Studio Code</a></li><li class="navListItem"><a class="navItem" href="/docs/from-typescript">TypeScript ↔ Sorbet</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Static &amp; Runtime</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/gradual">Gradual Type Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/static">Enabling Static Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/runtime">Enabling Runtime Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/rbi">RBI Files</a></li><li class="navListItem"><a class="navItem" href="/docs/cli">CLI Quickstart</a></li><li class="navListItem"><a class="navItem" href="/docs/cli-ref">CLI Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/tconfiguration">Runtime Configuration</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/troubleshooting">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/docs/why-type-annotations">Why type annotations?</a></li><li class="navListItem"><a class="navItem" href="/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/error-reference">Error Reference</a></li><li class="navListItem"><a class="navItem" href="/docs/unsupported">Unsupported Ruby Features</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Type System</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/sigs">sig</a></li><li class="navListItem"><a class="navItem" href="/docs/type-annotations">Type Annotations (non-sig)</a></li><li class="navListItem"><a class="navItem" href="/docs/type-assertions">T.let, T.cast, T.must, T.bind</a></li><li class="navListItem"><a class="navItem" href="/docs/class-types">Class Types (Integer, String)</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/stdlib-generics">Arrays &amp; Hashes</a></li><li class="navListItem"><a class="navItem" href="/docs/nilable-types">Nilable Types (T.nilable)</a></li><li class="navListItem"><a class="navItem" href="/docs/union-types">Union Types (T.any)</a></li><li class="navListItem"><a class="navItem" href="/docs/flow-sensitive">Flow-Sensitivity (is_a?, nil?)</a></li><li class="navListItem"><a class="navItem" href="/docs/type-aliases">T.type_alias</a></li><li class="navListItem"><a class="navItem" href="/docs/exhaustiveness">Exhaustiveness (T.absurd)</a></li><li class="navListItem"><a class="navItem" href="/docs/tstruct">T::Struct</a></li><li class="navListItem"><a class="navItem" href="/docs/tenum">T::Enum</a></li><li class="navListItem"><a class="navItem" href="/docs/untyped">T.untyped</a></li><li class="navListItem"><a class="navItem" href="/docs/procs">Blocks, Procs, &amp; Lambdas</a></li><li class="navListItem"><a class="navItem" href="/docs/abstract">Abstract Classes &amp; Interfaces</a></li><li class="navListItem"><a class="navItem" href="/docs/final">Final Methods &amp; Classes</a></li><li class="navListItem"><a class="navItem" href="/docs/override-checking">Override Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/sealed">Sealed Classes</a></li><li class="navListItem"><a class="navItem" href="/docs/class-of">T.class_of</a></li><li class="navListItem"><a class="navItem" href="/docs/self-type">T.self_type</a></li><li class="navListItem"><a class="navItem" href="/docs/noreturn">T.noreturn</a></li><li class="navListItem"><a class="navItem" href="/docs/anything">T.anything</a></li><li class="navListItem"><a class="navItem" href="/docs/attached-class">T.attached_class</a></li><li class="navListItem"><a class="navItem" href="/docs/intersection-types">Intersection Types (T.all)</a></li><li class="navListItem"><a class="navItem" href="/docs/generics">Generics</a></li><li class="navListItem"><a class="navItem" href="/docs/strong">Banning untyped</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Ruby &amp; DSL Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/attr_reader">attr_reader</a></li><li class="navListItem"><a class="navItem" href="/docs/minitest">minitest</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Editor Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/lsp">Language Server (LSP)</a></li><li class="navListItem"><a class="navItem" href="/docs/server-status">Server Status</a></li><li class="navListItem"><a class="navItem" href="/docs/lsp-typed-level">LSP &amp; Typed Level</a></li><li class="navListItem"><a class="navItem" href="/docs/go-to-def">Go to Definition</a></li><li class="navListItem"><a class="navItem" href="/docs/hover">Hover</a></li><li class="navListItem"><a class="navItem" href="/docs/autocompletion">Autocompletion</a></li><li class="navListItem"><a class="navItem" href="/docs/references">Find All References</a></li><li class="navListItem"><a class="navItem" href="/docs/code-actions">Code Actions</a></li><li class="navListItem"><a class="navItem" href="/docs/outline">Outline &amp; Document Symbols</a></li><li class="navListItem"><a class="navItem" href="/docs/doc-comments">Documentation Comments</a></li><li class="navListItem"><a class="navItem" href="/docs/sig-suggestion">Suggesting sigs</a></li><li class="navListItem"><a class="navItem" href="/docs/highlight-untyped">Highlighting untyped</a></li><li class="navListItem"><a class="navItem" href="/docs/sorbet-uris">sorbet: URIs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Experimental Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/tuples">Tuples</a></li><li class="navListItem"><a class="navItem" href="/docs/shapes">Shapes</a></li><li class="navListItem"><a class="navItem" href="/docs/overloads">Overloads</a></li><li class="navListItem"><a class="navItem" href="/docs/requires-ancestor">Requiring Ancestors</a></li><li class="navListItem"><a class="navItem" href="/docs/rbs-support">RBS Comments</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/sorbet/sorbet/edit/master/website/docs/stdlib-generics.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Arrays, Hashes, and Generics in the Standard Library</h1></header><article><div><span><p>The Sorbet syntax for type annotations representing arrays, hash maps, and other containers defined in the Ruby standard library looks different from other <a href="/docs/class-types">class types</a> despite the fact that Ruby uses classes to represent these values, too. Here’s the syntax Sorbet uses:</p>
<table>
<thead>
<tr><th>Type</th><th>Example value</th></tr>
</thead>
<tbody>
<tr><td><code>T::Array[Integer]</code></td><td><code>[1, 2, 3]</code></td></tr>
<tr><td><code>T::Array[String]</code></td><td><code>[&quot;hello&quot;, &quot;goodbye&quot;]</code></td></tr>
<tr><td><code>T::Hash[Symbol, Integer]</code></td><td><code>{key: 0}</code></td></tr>
<tr><td><code>T::Hash[String, Float]</code></td><td><code>{&quot;key&quot; =&gt; 0.0}</code></td></tr>
<tr><td><code>T::Set[Integer]</code></td><td><code>Set[1, 2, 3]</code></td></tr>
<tr><td><code>T::Range[Integer]</code></td><td><code>0..10</code></td></tr>
<tr><td><code>T::Enumerable[Integer]</code></td><td><em>interface implemented by many types</em></td></tr>
<tr><td><code>T::Enumerator[Integer]</code></td><td>[1, 2, 3].each</td></tr>
<tr><td><code>T::Enumerator::Lazy[Integer]</code></td><td>[1, 2, 3].each.lazy</td></tr>
<tr><td><code>T::Enumerator::Chain[Integer]</code></td><td>[1, 2].chain([3])</td></tr>
<tr><td><code>T::Class[Integer]</code></td><td>Integer</td></tr>
<tr><td><code>T::Module[Integer]</code></td><td>Kernel</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="why-the-t-prefix"></a><a href="#why-the-t-prefix" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why the <code>T::</code> prefix?</h2>
<p>Sorbet uses syntax like <code>MyClass[Elem]</code> for type arguments passed to <a href="/docs/generics">generic classes</a>. All Sorbet type annotations are backwards compatible with normal Ruby syntax, and this is no exception. In normal Ruby, <code>MyClass[Elem]</code> would correspond to a call to a method named <code>[]</code> defined on <code>MyClass</code>.</p>
<p>When creating user-defined generic classes, the <code>sorbet-runtime</code> gem automatically defines this method so that the type annotation syntax works at runtime.</p>
<p>But for classes in the Ruby standard library, which Sorbet retroactively defined as generic classes, the <code>[]</code> method will not be defined at runtime. One potential option would have been to use <code>sorbet-runtime</code> to monkey patch the standard library so that the <code>[]</code> method is defined for generic classes, but some of these Ruby standard library classes <strong>already</strong> define a meaningful <code>[]</code> method. For example:</p>
<pre><code class="hljs css language-ruby">Array[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
<span class="hljs-comment"># =&gt; evaluates to the array `[1, 2, 3]`</span>

Set[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
<span class="hljs-comment"># =&gt; evaluates to the set containing 1, 2, and 3</span>

Hash[<span class="hljs-symbol">:key1</span>, <span class="hljs-number">1</span>, <span class="hljs-symbol">:key2</span>, <span class="hljs-number">2</span>]
<span class="hljs-comment"># =&gt; evaluates to the hash `{key1: 1, key2: 2}`</span>
</code></pre>
<p>To avoid clobbering any existing <code>[]</code> method on these standard library classes, Sorbet defines classes in the <code>T::</code> namespace that mirror the names of classes in the standard library.</p>
<blockquote>
<p>Note that this mapping is not automatic: Sorbet has special-cased each individual class in the table above inside Sorbet (it is not possible to use merely prepend <code>T::</code> to the name of any class that has been defined as a generic type in an <a href="/docs/rbi">RBI file</a>).</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="generic-class-without-type-arguments"></a><a href="#generic-class-without-type-arguments" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>“Generic class without type arguments”</h2>
<p>For backwards compatibility reasons during Sorbet’s original rollout, Sorbet sometimes allows generic classes defined in the Ruby standard library to appear in type annotations <em>without</em> being provided type arguments:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># typed: true</span>
<span class="hljs-comment">#        ^^^^ important</span>

T.let([], Array) <span class="hljs-comment"># no error</span>
</code></pre>
<p>versus:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># typed: strict</span>

T.let([], Array)
<span class="hljs-comment">#         ^^^^^ error: Generic class without type arguments</span>
</code></pre>
<p>When this happens, Sorbet defaults all missing type arguments to <code>T.untyped</code>.</p>
<p>This exception is made only for classes in the Ruby standard library. For all other generic classes, Sorbet requires that a generic class is provided all of its required type arguments, even in <code># typed: false</code> files.</p>
<p>This behavior may change in the future, and we strongly discourage relying on it intentionally.</p>
<h2><a class="anchor" aria-hidden="true" id="generics-and-runtime-checks"></a><a href="#generics-and-runtime-checks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generics and runtime checks</h2>
<p>Recall that Sorbet is not only a static type checker, but also a system for <a href="/docs/runtime">validating types at runtime</a>.</p>
<p>However, Sorbet completely erases <em>generic type arguments</em> at runtime. When Sorbet sees a signature like <code>T::Array[Integer]</code>, at runtime it will <strong>only</strong> check whether an argument has class <code>Array</code>, but not whether every element of that array is also an <code>Integer</code> at runtime.</p>
<p>This also means that if the element type of an array has type <a href="/docs/untyped"><code>T.untyped</code></a>, Sorbet will not report a static error, nor will Sorbet report a runtime error.</p>
<pre><code class="hljs css language-ruby">sig { params(<span class="hljs-symbol">xs:</span> T::Array[Integer]).void }
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span><span class="hljs-params">(xs)</span></span>; <span class="hljs-keyword">end</span>

untyped_str_array = T::Array[T.untyped].new(<span class="hljs-string">'first'</span>, <span class="hljs-string">'second'</span>)
foo(untyped_str_array)
<span class="hljs-comment">#   ^^^^^^^^^^^^^^^^^ no static error, AND no runtime error!</span>
</code></pre>
<p>(Also note that unlike other languages that implement generics via type erasure, Sorbet does not insert runtime casts that preserve type safety at runtime.)</p>
<p>Another consequence of having erased generics is that things like this will not work:</p>
<pre><code class="hljs css language-ruby">sig { params(<span class="hljs-symbol">xs:</span> T.any(T::Array[Integer], T::Array[String])).void }
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">example</span><span class="hljs-params">(xs)</span></span>
  <span class="hljs-keyword">if</span> xs.is_a?(T::Array[Integer]) <span class="hljs-comment"># error!</span>
    <span class="hljs-comment"># ...</span>
  <span class="hljs-keyword">elsif</span> xs.is_a?(T::Array[String]) <span class="hljs-comment"># error!</span>
    <span class="hljs-comment"># ...</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Sorbet will attempt to detect cases where it looks like this is happening and report a static error, but it cannot do so in all cases.</p>
<blockquote>
<p><strong>Note</strong>: Sorbet used to take these type arguments into account during runtime type-checking, but this turned out to be a common and difficult-to-debug source of performance problems, frequently turning a fast, constant-time algorithm (e.g., <code>Hash</code> lookup) into a linear scan checking all element types.</p>
<p>In order to verify that an array contained the values it claimed it did, the Sorbet runtime used to recursively check the type of every member of a collection, which would take a long time for arrays or hashes of a sufficiently large size. Consequently, this behavior has been removed.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="standard-library-generics-and-variance"></a><a href="#standard-library-generics-and-variance" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Standard library generics and variance</h2>
<p>Note that all the classes in the Ruby standard library that Sorbet knows about are <strong>covariant</strong> in their generic type members. Variance is is discussed in the docs for <a href="/docs/generics">Generic Classes and Methods</a>.</p>
<p>Implementing covariant classes in the Ruby standard library is a compromise. It means that things like this typecheck:</p>
<pre><code class="hljs css language-ruby">sig { returns(T::Array[Integer]) }
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">returns_ints</span>;</span> [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-keyword">end</span>

sig { params(<span class="hljs-symbol">xs:</span> T::Array[T.any(Integer, String)]).void }
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">takes_ints_or_strings</span><span class="hljs-params">(xs)</span></span>; <span class="hljs-keyword">end</span>

xs = returns_ints
takes_ints_or_strings(xs) <span class="hljs-comment"># no error</span>
</code></pre>
<p>This makes it easy to get the most common Ruby usage patterns to type check without jumping through hoops.</p>
<p><strong>However</strong>, having things like arrays and hash maps in Ruby be covariant means that the type checker wilfully says certain programs type check even when they have glaring type errors. For example:</p>
<pre><code class="hljs css language-ruby">xs = T.let([<span class="hljs-number">0</span>], T::Array[Integer])
nil_xs = T.let(xs, T::Array[T.nilable(Integer)])
nil_xs[<span class="hljs-number">0</span>] = <span class="hljs-literal">nil</span>

T.reveal_type(xs.fetch(<span class="hljs-number">0</span>)) <span class="hljs-comment"># type: Integer (!)</span>
puts xs.fetch(<span class="hljs-number">0</span>)           <span class="hljs-comment"># =&gt; nil        (!)</span>
</code></pre>
<p>In this example, we start with <code>xs</code> having type <code>T::Array[Integer]</code>. We then upcast it to a <code>T::Array[T.nilable(Integer)]</code>. This is the power of covariance—this would not have been allowed had arrays been made invariant.</p>
<p>Sorbet allows <code>nil_xs[0] = nil</code> because the type of <code>nil_xs</code> says that it’s fine for the array to contain <code>nil</code> values.</p>
<p>But that’s a contradiction! <code>nil_xs</code> and <code>xs</code> are merely different names for the same underlying storage. Later if someone were to go back and read the first element of <code>xs</code>, Sorbet would claim that they’re getting back an <code>Integer</code>, but in fact, they’d be getting back a <code>nil</code>.</p>
<p>Sorbet is not the only type system to implement covariant arrays. Notably: TypeScript uses the same approach. This decision was largely motivated by getting as much Ruby code to typecheck when initially developing and rolling out Sorbet on large, existing codebases.</p>
<h2><a class="anchor" aria-hidden="true" id="implementing-the-enumerable-interface"></a><a href="#implementing-the-enumerable-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementing the <code>Enumerable</code> interface</h2>
<p>Here’s how to implement an enumerable class in Ruby with Sorbet:</p>
<pre><code class="hljs css language-ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CountTo3</span></span>
  <span class="hljs-keyword">include</span> Enumerable

  <span class="hljs-comment"># Must declare Elem type</span>
  extend T::Generic
  Elem = type_member(<span class="hljs-symbol">:out</span>) { {<span class="hljs-symbol">fixed:</span> Integer} }

  <span class="hljs-comment"># Must implement abstract `Enumerable#each` method</span>
  sig <span class="hljs-keyword">do</span>
    override
      .params(
        <span class="hljs-symbol">blk:</span> T.proc.params(<span class="hljs-symbol">arg0:</span> Elem).returns(T.anything)
      )
      .void
  <span class="hljs-keyword">end</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">each</span><span class="hljs-params">(&amp;blk)</span></span>
    <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-number">3</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

counter = CountTo3.new
total = counter.sum <span class="hljs-comment"># calls Enumerable#sum</span>
</code></pre>
<p>Sorbet treats the <code>Enumerable</code> module in the standard library as an <a href="/docs/abstract">abstract module</a> and as a <a href="/docs/generics">generic module</a>. That means that putting <code>include Enumerable</code> inside a class requires defining two things:</p>
<ol>
<li><p>An <code>each</code> method which overrides the abstract <code>Enumerable#each</code> method.</p>
<p>The <code>each</code> method is what powers all the other methods that the <code>Enumerable</code> module provides, like <code>map</code>, <code>include?</code>, <code>all?</code>, etc. Sorbet requires that implementations of abstract methods must have use <a href="/docs/abstract#implementing-an-abstract-method">the <code>override</code> modifier</a> in the signature.</p>
<p>Sorbet includes an autocorrect to automatically generate empty implementations of any missing abstract methods—this is the easiest way to get started implementing an <code>each</code> method with the correct signature.</p>
<p>For legacy reasons, the return type of the <code>Enumerable#each</code> method is <code>T.untyped</code> and the return type of the block is <code>BasicObject</code>. In new code, we recommend using <code>.void</code> and <code>T.anything</code> respectively (making this change in <code>Enumerable#each</code> would be a breaking change, which we might consider making one day).</p></li>
<li><p>A generic <code>type_member</code> called <code>Elem</code> declaring what kinds of elements this class will enumerate. The class will need to <code>extend T::Generic</code> to make the <code>type_member</code> method available.</p>
<p>If the class will always enumerate values of a type which is known ahead of time, declare the elem <a href="/docs/generics#bounds-on-type_members-and-type_templates-fixed-upper-lower">using a <code>fixed</code> bound</a>. The <code>CountTo3</code> example above uses a <code>fixed</code> bound because it always yields <code>Integer</code> values.</p>
<blockquote>
<p><strong>Note</strong>: to reiterate, simply including <code>Enumerable</code> in a class automatically makes that class generic, even if that class would not otherwise seem “generic.” Use the <code>fixed</code> annotation seen above in these cases.</p>
</blockquote>
<p>Otherwise, leave the bound unspecified. This approach is more suitable for implementing generic containers, like how <code>Array</code> and <code>Set</code> are generic containers.</p>
<p>Be sure to declare <code>Elem</code> as a covariant type member, <a href="/docs/generics#covariance-out">using <code>type_member(:out)</code></a> unless there’s a strong reason to do otherwise.</p>
<p>For ease of migration in legacy codebases and gems which already have many custom <code>Enumerable</code> subclasses, Sorbet only requires declaring the <code>Elem</code> <code>type_member</code> at <code># typed: strict</code>.</p></li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="whats-next"></a><a href="#whats-next" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What’s next?</h2>
<ul>
<li><p><a href="/docs/class-types">Class Types</a></p>
<p>Every Ruby class and module doubles as a type in Sorbet. Class types supersede the notion some other languages have of “primitive” types. For example, <code>&quot;abc&quot;</code> is an instance of the <code>String</code> class, and so <code>&quot;abc&quot;</code> has type <code>String</code>.</p></li>
<li><p><a href="/docs/generics">Generic Classes and Methods</a></p>
<p>Types do not have to belong in the Ruby standard library to be declared as generic types. Read more about how to define custom generic classes and methods.</p></li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/class-types"><span class="arrow-prev">← </span><span>Class Types (Integer, String)</span></a><a class="docs-next button" href="/docs/nilable-types"><span>Nilable Types (T.nilable)</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#why-the-t-prefix">Why the <code>T::</code> prefix?</a></li><li><a href="#generic-class-without-type-arguments">&quot;Generic class without type arguments&quot;</a></li><li><a href="#generics-and-runtime-checks">Generics and runtime checks</a></li><li><a href="#standard-library-generics-and-variance">Standard library generics and variance</a></li><li><a href="#implementing-the-enumerable-interface">Implementing the <code>Enumerable</code> interface</a></li><li><a href="#whats-next">What's next?</a></li></ul></nav></div><footer class="nav-footer" id="footer"><div class="wrapper"><p class="footer"><svg width="99" height="28" viewBox="0 0 99 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.98432 20H6.27432C8.44932 20 9.81432 18.905 9.81432 17.03C9.81432 15.665 9.00432 14.72 7.78932 14.39C8.61432 14.105 9.45432 13.415 9.45432 12.035C9.45432 10.235 8.23932 9.23 5.95932 9.23H1.98432V20ZM3.37932 13.85V10.445H5.83932C7.27932 10.445 8.07432 11 8.07432 12.155C8.07432 13.295 7.27932 13.85 5.83932 13.85H3.37932ZM3.37932 15.08H6.21432C7.65432 15.08 8.43432 15.83 8.43432 16.925C8.43432 18.035 7.65432 18.785 6.21432 18.785H3.37932V15.08ZM18.0294 12.155H16.6794V16.88C16.6794 18.185 15.6894 18.92 14.7144 18.92C13.5594 18.92 13.0794 18.17 13.0794 17.06V12.155H11.7294V17.345C11.7294 19.01 12.6744 20.165 14.3544 20.165C15.4644 20.165 16.2294 19.58 16.6794 18.92V20H18.0294V12.155ZM20.5112 10.79H21.9812V9.23H20.5112V10.79ZM21.9212 12.155H20.5712V20H21.9212V12.155ZM25.8247 9.23H24.4747V20H25.8247V9.23ZM28.5882 18.125C28.5882 19.625 29.3532 20.075 30.6882 20.075C31.1382 20.075 31.5282 20.03 31.8732 19.955V18.8C31.5582 18.875 31.3332 18.89 31.0182 18.89C30.3282 18.89 29.9232 18.74 29.9232 17.915V13.31H31.7082V12.155H29.9232V9.86H28.5882V12.155H27.3732V13.31H28.5882V18.125ZM41.0199 20.165C43.1949 20.165 44.4399 18.305 44.4399 16.085C44.4399 13.85 43.1949 12.005 41.0199 12.005C39.9249 12.005 39.0549 12.53 38.5899 13.295V9.23H37.2399V20H38.5899V18.86C39.0549 19.64 39.9249 20.165 41.0199 20.165ZM38.5599 15.815C38.5599 13.985 39.6699 13.19 40.7799 13.19C42.2499 13.19 43.0749 14.39 43.0749 16.085C43.0749 17.765 42.2499 18.98 40.7799 18.98C39.6699 18.98 38.5599 18.17 38.5599 16.37V15.815ZM49.1804 20.855L52.5554 12.155H51.1454L48.9704 18.155L46.7654 12.155H45.3404L48.2504 19.715L47.8754 20.645C47.5604 21.425 47.2454 21.635 46.6604 21.635C46.4354 21.635 46.2704 21.62 46.0154 21.56V22.73C46.2554 22.775 46.4204 22.79 46.7504 22.79C48.1154 22.79 48.7304 22.04 49.1804 20.855Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M98.7993 15.7838C98.7993 12.8786 97.3871 10.5862 94.688 10.5862C91.9774 10.5862 90.3374 12.8786 90.3374 15.7611C90.3374 19.177 92.2735 20.9019 95.0524 20.9019C96.4077 20.9019 97.4327 20.5955 98.2071 20.1643V17.8946C97.4327 18.2804 96.5443 18.5188 95.4168 18.5188C94.3121 18.5188 93.3327 18.1329 93.2074 16.7938H98.7766C98.7766 16.6463 98.7993 16.0561 98.7993 15.7838ZM93.1732 14.7057C93.1732 13.4233 93.9591 12.8899 94.6766 12.8899C95.3713 12.8899 96.1116 13.4233 96.1116 14.7057H93.1732Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M85.9413 10.5862C84.8251 10.5862 84.1076 11.1082 83.709 11.4714L83.561 10.7678H81.0554V24.0001L83.9026 23.3986L83.914 20.187C84.324 20.482 84.9276 20.9019 85.9299 20.9019C87.9685 20.9019 89.8249 19.2678 89.8249 15.6703C89.8135 12.3792 87.9343 10.5862 85.9413 10.5862ZM85.2579 18.4053C84.586 18.4053 84.1874 18.167 83.914 17.8719L83.9026 13.6616C84.1988 13.3325 84.6088 13.1055 85.2579 13.1055C86.2943 13.1055 87.0118 14.2631 87.0118 15.7497C87.0118 17.2704 86.3057 18.4053 85.2579 18.4053Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M77.1377 9.91656L79.9963 9.30374V7L77.1377 7.60147V9.91656Z" fill="white"></path><path d="M79.9963 10.7791H77.1377V20.709H79.9963V10.7791Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M74.074 11.6187L73.8918 10.7789H71.4318V20.7088H74.279V13.9792C74.9509 13.1054 76.0898 13.2642 76.4429 13.3891V10.7789C76.0784 10.6427 74.7459 10.3931 74.074 11.6187Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M68.3796 8.31641L65.6007 8.90653L65.5894 17.9966C65.5894 19.6762 66.8535 20.9132 68.5391 20.9132C69.473 20.9132 70.1563 20.743 70.5321 20.5387V18.235C70.1677 18.3825 68.3682 18.9045 68.3682 17.225V13.1962H70.5321V10.779H68.3682L68.3796 8.31641Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M60.6807 13.6616C60.6807 13.219 61.0452 13.0488 61.6488 13.0488C62.5143 13.0488 63.6076 13.3098 64.4732 13.7751V11.1082C63.5279 10.7337 62.594 10.5862 61.6488 10.5862C59.3368 10.5862 57.7993 11.7891 57.7993 13.7978C57.7993 16.93 62.1271 16.4306 62.1271 17.7811C62.1271 18.3031 61.6715 18.4734 61.0338 18.4734C60.0885 18.4734 58.8813 18.0875 57.9246 17.5655V20.2664C58.9838 20.7204 60.0543 20.9133 61.0338 20.9133C63.4026 20.9133 65.0313 19.7444 65.0313 17.713C65.0199 14.3312 60.6807 14.9326 60.6807 13.6616Z" fill="white"></path></svg><a href="/docs/adopting">Get started</a> · <a href="/docs/overview">Docs</a> · <a href="https://sorbet.run">Try</a> · <a href="/en/community">Community</a> · <a href="/blog">Blog</a> · <a href="https://twitter.com/sorbet_ruby">Twitter</a></p></div><div id="csat-extension-config" data-notify="#sorbet-team"></div></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                appId: 'ZYWC6Z01G8',
                apiKey: 'b05a65e9f8d9f50dc4ec3241db8836c4',
                indexName: 'stripe_sorbet',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>