<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>RBI Files · Sorbet</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;!-- TODO(jez) Linkify all `sorbet-typed` references in this document --&gt;"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="RBI Files · Sorbet"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sorbet.org/"/><meta property="og:description" content="&lt;!-- TODO(jez) Linkify all `sorbet-typed` references in this document --&gt;"/><meta property="og:image" content="https://sorbet.org/img/sorbet-logo-purple-sparkles.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sorbet.org/img/sorbet-logo-purple-sparkles.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/sorbet-logo-white-sparkles.svg" alt="Sorbet"/><h2 class="headerTitleWithLogo">Sorbet</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/adopting" target="_self">Get started</a></li><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Docs</a></li><li class=""><a href="https://sorbet.run" target="_self">Try it online</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Static &amp; Runtime</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/adopting">Adopting Sorbet</a></li><li class="navListItem"><a class="navItem" href="/docs/quickref">Quick Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Static &amp; Runtime</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/gradual">Gradual Type Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/static">Enabling Static Checks</a></li><li class="navListItem"><a class="navItem" href="/docs/runtime">Enabling Runtime Checks</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/rbi">RBI Files</a></li><li class="navListItem"><a class="navItem" href="/docs/cli">Command Line Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Troubleshooting</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/troubleshooting">Troubleshooting</a></li><li class="navListItem"><a class="navItem" href="/docs/faq">FAQ</a></li><li class="navListItem"><a class="navItem" href="/docs/error-reference">Error Reference</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Type System</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/sigs">Signatures</a></li><li class="navListItem"><a class="navItem" href="/docs/class-types">Class Types</a></li><li class="navListItem"><a class="navItem" href="/docs/nilable-types">Nilable Types</a></li><li class="navListItem"><a class="navItem" href="/docs/union-types">Union Types</a></li><li class="navListItem"><a class="navItem" href="/docs/flow-sensitive">Flow Sensitivity</a></li><li class="navListItem"><a class="navItem" href="/docs/type-assertions">Type Assertions</a></li><li class="navListItem"><a class="navItem" href="/docs/exhaustiveness">Exhaustiveness Checking</a></li><li class="navListItem"><a class="navItem" href="/docs/tuples">Tuples</a></li><li class="navListItem"><a class="navItem" href="/docs/shapes">Shapes</a></li><li class="navListItem"><a class="navItem" href="/docs/untyped">T.untyped</a></li><li class="navListItem"><a class="navItem" href="/docs/noreturn">T.noreturn</a></li><li class="navListItem"><a class="navItem" href="/docs/type-aliases">Type Aliases</a></li><li class="navListItem"><a class="navItem" href="/docs/stdlib-generics">Builtin Generics</a></li><li class="navListItem"><a class="navItem" href="/docs/procs">Proc Types</a></li><li class="navListItem"><a class="navItem" href="/docs/class-of">T.class_of</a></li><li class="navListItem"><a class="navItem" href="/docs/self-type">T.self_type</a></li><li class="navListItem"><a class="navItem" href="/docs/abstract">Abstract Classes and Interfaces</a></li><li class="navListItem"><a class="navItem" href="/docs/strict">Strict Mode</a></li><li class="navListItem"><a class="navItem" href="/docs/intersection-types">Intersection Types</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/stripe/sorbet/edit/master/website/docs/rbi.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">RBI Files</h1></header><article><div><span><!-- TODO(jez) Linkify all `sorbet-typed` references in this document -->
<p>RBI files are &quot;Ruby Interface&quot; files. Sorbet uses RBI files to learn about
constants, ancestors, and methods defined in ways it doesn't understand
natively. By default, Sorbet does <strong>not</strong> know about:</p>
<ul>
<li>anything defined within a gem</li>
<li>ancestors modified with dynamic includes (<code>other.extend(...)</code>)</li>
<li>constants accessed or defined with <code>const_get</code> or <code>const_set</code></li>
<li>methods defined with <code>define_method</code> or <code>method_missing</code></li>
</ul>
<p>RBI files lie at the intersection of the <a href="/docs/static">static</a> and
<a href="/docs/runtime">dynamic</a> components of Sorbet. They can be autogenerated using
Ruby's reflection APIs at runtime or written by users of Sorbet. This doc
answers three main questions:</p>
<ul>
<li>How can we create and update RBI files?</li>
<li>What is the syntax of an RBI file?</li>
<li>What kinds of RBI files exist in a project?</li>
</ul>
<p>We'll cover these questions in order.</p>
<h2><a class="anchor" aria-hidden="true" id="quickref"></a><a href="#quickref" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Quickref</h2>
<p>These are the many commands to create or update RBI files within a Sorbet
project:</p>
<table>
<thead>
<tr><th>I want to:</th><th>so I'll run:</th></tr>
</thead>
<tbody>
<tr><td>Initialize a new Sorbet project, including all RBI files</td><td><code>srb init</code></td></tr>
<tr><td>Update every kind of RBI in an existing project</td><td><code>srb rbi update</code></td></tr>
<tr><td> </td><td> </td></tr>
<tr><td>Fetch pre-written RBIs (either from gem sources or <code>sorbet-typed</code>)</td><td><code>srb rbi sorbet-typed</code></td></tr>
<tr><td>(Re)generate RBIs for all gems using runtime reflection</td><td><code>srb rbi gems</code></td></tr>
<tr><td>(Re)generate an RBI for all &quot;hidden definitions&quot; in a project</td><td><code>srb rbi hidden-definitions</code></td></tr>
<tr><td>(Re)generate a the TODO RBI file (for missing constants)</td><td><code>srb rbi todo</code></td></tr>
</tbody>
</table>
<p>For more information about <code>srb init</code>, see <a href="/docs/adopting">Adopting Sorbet</a>.</p>
<p>Note that <code>srb rbi update</code> is an alias for <code>srb init</code>.</p>
<p>The subcommands are discussed below (alongside the different kinds of RBI
files).</p>
<h2><a class="anchor" aria-hidden="true" id="syntax"></a><a href="#syntax" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Syntax</h2>
<p>The syntax of RBI files is the same as normal Ruby files, except that method
definitions do not need implementations. The only new syntax is for method
signatures (which <a href="/docs/sigs#why-are-signatures-ruby-syntax">are themselves valid Ruby syntax</a>). See
<a href="/docs/sigs">Writing sigs</a> for the syntax of method signatures.</p>
<pre><code class="hljs css language-ruby"><span class="hljs-comment"># -- example.rbi --</span>
<span class="hljs-comment"># typed: strict</span>

<span class="hljs-comment"># Declares a module</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">MyModule</span></span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment"># Declares a class</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span></span>
  <span class="hljs-comment"># Declares what modules this class mixes in</span>
  <span class="hljs-keyword">include</span> MyModule
  extend MyModule

  <span class="hljs-comment"># Declares an untyped method</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">foo</span></span>
  <span class="hljs-keyword">end</span>

  <span class="hljs-comment"># Declares a method with input and output types</span>
  Sorbet.sig {params(<span class="hljs-symbol">x:</span> Integer).returns(String)}
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bar</span><span class="hljs-params">(x)</span></span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment"># Declares a class that subclasses another class</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> &lt; Parent</span>
  <span class="hljs-comment"># Declares an Integer constant, with an arbitrary value</span>
  X = T.let(T.unsafe(<span class="hljs-literal">nil</span>), Integer)
<span class="hljs-keyword">end</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="gem-rbis"></a><a href="#gem-rbis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Gem RBIs</h2>
<p>RBIs are predominantly used to define classes, constants, and methods to Sorbet.
Sorbet does not look at the source code of gems that a project depends on (in
general, this would make Sorbet slower to typecheck a project and also toilsome
if any gems don't typecheck on their own).</p>
<p>Instead, there are three ways to get RBI files to teach Sorbet about a gem:</p>
<ul>
<li>By using <code>srb</code> to create RBIs using runtime reflection.</li>
<li>By handwriting RBIs for a gem, or using handwritten RBIs the Sorbet community
has shared.</li>
<li>By including RBI files directly within the source of a gem.</li>
</ul>
<p>We'll discuss each one of these in turn.</p>
<h3><a class="anchor" aria-hidden="true" id="autogenerated-rbis-for-gems"></a><a href="#autogenerated-rbis-for-gems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Autogenerated RBIs for gems</h3>
<p>The most common way to get RBI files for gems is to generate (or regenerate)
them. To regenerate RBI files in an already-initialized project:</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Update only the autogenerated gem RBIs:</span>
srb rbi gems

<span class="hljs-comment"># Update every kind of RBI file, including autogenerated gem RBIs:</span>
srb rbi update
</code></pre>
<p>The way this works is that <code>srb</code> will load a project's Gemfile and <code>require</code>
each gem declared within. While loading each gem, it uses runtime reflection to
learn what things that gem defines, and then serializes this information into a
single RBI file for that gem.</p>
<p>This process is somewhat imperfect, but it's a good start. Importantly, because
it only loads a gem's code, it can only know the arity of methods defined, but
not what types of values the methods accept or return.</p>
<h3><a class="anchor" aria-hidden="true" id="hand-written-rbis-for-gems"></a><a href="#hand-written-rbis-for-gems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hand-written RBIs for gems</h3>
<p>An alternative to autogenerated RBI files are hand-written RBI files. For
example, Sorbet itself ships with hand-written RBIs for the Ruby standard
library. Hand-written RBI files have the advantage that in addition to capturing
a method's arity, they can also declare a method's input and output types.</p>
<p>Hand-written RBIs for gems can come from either:</p>
<ul>
<li><code>sorbet-typed</code>, a central repository for sharing hand-written RBI files with
the Sorbet community, or</li>
<li>you!</li>
</ul>
<p>When initializing a new Sorbet project, <code>srb init</code> reads the project's
<code>Gemfile</code>, checks to see if <code>sorbet-typed</code> already has any suitable RBI files,
and fetches them into the current project if so. After initialization, to
update or add new RBI files from <code>sorbet-typed</code>, run:</p>
<pre><code class="hljs css language-bash">srb rbi sorbet-typed
</code></pre>
<p>When <code>sorbet-typed</code> does not have RBI files for a gem, <code>srb init</code> will still
have created some autogenerated RBI files for that gem. These autogenerated
files are a <strong>great</strong> way to start off writing hand-written RBIs for a gem!
Simply move the autogenerated file out of the RBI <code>sorbet/rbi/sorbet-typed/</code>
folder, and start modifying it by hand.</p>
<h3><a class="anchor" aria-hidden="true" id="rbis-within-gems"></a><a href="#rbis-within-gems" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RBIs within gems</h3>
<p>The last way to include RBI files for a gem into a project is for the gem itself
to ship with RBI files. In the future, we anticipate this to be the preferred
way to include RBI files into a project.</p>
<p>The way this works is that when <code>srb</code> will load a project's <code>Gemfile</code> to find
the source folders for every gem in a project. If any gems have a top-level
<code>rbi/</code> or <code>rbis/</code> folder, <code>srb</code> will collect the paths to any such folders into
a file (<code>sorbet/rbi_list</code>) and mention this file in the <code>sorbet/config</code> file.</p>
<h2><a class="anchor" aria-hidden="true" id="the-hidden-definition-rbi"></a><a href="#the-hidden-definition-rbi" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Hidden Definition RBI</h2>
<p>When typechecking an existing Ruby project with Sorbet, usually type annotations
for all the gems are not enough to statically understand everything that's going
on. Ruby as a language is well-known for encouraging <em>metaprogramming</em>, or
defining things at runtime. In Sorbet, we call anything that can't be seen
statically but which is defined at runtime a <strong>hidden definition</strong>. This
includes constants defined with <code>const_set</code>, methods defined with
<code>define_method</code>, ancestor lists modified within methods (instead of at the
top-level of a class), and more.</p>
<p>In order to find all the hidden definitions in a project, Sorbet does three
things:</p>
<ul>
<li>loads an entire project, and walks every object in <code>ObjectSpace</code> to see what's
defined</li>
<li>runs Sorbet on the entire project in a mode where Sorbet will emit something
for every definition</li>
<li>subtract these two lists of definitions, and serialize an RBI file for the
difference</li>
</ul>
<p>Like with autogenerated gem RBI files, the methods defined in the hidden
definitions RBI file will all be untyped.</p>
<p>Unlike gem RBIs which only need to be updated when a gem is added, removed, or
updated, the hidden definitions might need to be updated frequently, depending
on how much metaprogramming a codebase is using. To regenerate the hidden
definitions RBI file:</p>
<pre><code class="hljs css language-bash">srb rbi hidden-definitions
</code></pre>
<p>On a philosophical level, we believe that while heavily metaprogrammed APIs
can make it easy for a code author, they're frequently harder for consumers of
the API to understand where things are being defined. By making metaprogramming
explicit in one file, it's easy to track whether the amount of metaprogramming
in a codebase is going up or down over time.</p>
<p>Sorbet offers a number of powerful type-level features to enforce
ergonomic abstractions. When writing new code or refactoring old code,
be sure to read up on <a href="/docs/abstract">Abstract methods and interfaces</a> and <a href="/docs/union-types">Union
types</a>, both of which allow code authors to write code that
Sorbet can understand and analyze more effectively.</p>
<h2><a class="anchor" aria-hidden="true" id="the-todo-rbi-file"></a><a href="#the-todo-rbi-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The TODO RBI file</h2>
<p>Sometimes even autogenerated gem RBI files and the hidden definitions RBI file
aren't enough to adopt Sorbet in a new codebase. Sorbet requires that all
constants resolve, and our runtime reflection to find constants is still
imperfect.</p>
<p>As one last attempt to ease the adoption process of Sorbet, when running <code>srb init</code> if after creating all these RBI files there are still missing constants,
we'll write out an RBI file that defines them, regardless of whether they exist
at runtime or not. <strong>This can be dangerous!</strong> In particular, at this point we're
not checking whether something was actually defined but Sorbet couldn't see it,
or whether it was never defined and is actually buggy code that hasn't been
caught by a project's test suite!</p>
<p>That's why this file is called the TODO RBI. After initializing a project to use
Sorbet, take a glance over the file at <code>sorbet/rbi/todo.rbi</code> and
attempt to find out why Sorbet thinks these constants are missing. Ask: is the
code actually covered by tests? Does the constant exist in an <code>irb</code> or <code>pry</code>
REPL session?</p>
<p>If after inspecting a constant in the TODO RBI file you're sure it should always
exist at runtime, feel free to move it out of the TODO RBI file and into a
hand-written RBI file.</p>
<h2><a class="anchor" aria-hidden="true" id="a-note-about-vendoring-rbis"></a><a href="#a-note-about-vendoring-rbis" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A note about vendoring RBIs</h2>
<p>You might have noticed that we <strong>vendor</strong> all gems' RBI files into the current
directory, and commit them to version control. Why? When developing RBI files
for Sorbet, we referenced the prior art that <a href="https://flow.org">Flow</a> developed.
Our reasoning is <a href="https://github.com/flow-typed/flow-typed/wiki/FAQs#why-do-i-need-to-commit-the-libdefs-that-flow-typed-installs-for-my-project">the same as theirs</a>:</p>
<p>When an RBI is improved or updated, there's some chance that the change could
introduce new Sorbet errors into the project. As good as it is to find new
issues, we also want to make sure that Sorbet errors in a project are consistent
and predictable over time.</p>
<p>So if/when we wish to upgrade an RBI that we've already checked in to our
project's version control, we can do so explicitly with the <code>srb rbi</code> command.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/runtime"><span class="arrow-prev">← </span><span>Enabling Runtime Checks</span></a><a class="docs-next button" href="/docs/cli"><span>Command Line Reference</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#quickref">Quickref</a></li><li><a href="#syntax">Syntax</a></li><li><a href="#gem-rbis">Gem RBIs</a><ul class="toc-headings"><li><a href="#autogenerated-rbis-for-gems">Autogenerated RBIs for gems</a></li><li><a href="#hand-written-rbis-for-gems">Hand-written RBIs for gems</a></li><li><a href="#rbis-within-gems">RBIs within gems</a></li></ul></li><li><a href="#the-hidden-definition-rbi">The Hidden Definition RBI</a></li><li><a href="#the-todo-rbi-file">The TODO RBI file</a></li><li><a href="#a-note-about-vendoring-rbis">A note about vendoring RBIs</a></li></ul></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'fa1ec885ab70787d636759b88e509b92',
                indexName: 'stripe_sorbet',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>